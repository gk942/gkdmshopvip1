<!DOCTYPE html>
<html>
<head>
  <title>Nạp tiền</title>
  <script src="firebase.js"></script>
</head>
<body>
  <h2>Thông tin chuyển khoản</h2>
  <p><strong>Số tài khoản:</strong> 0977049795</p>
  <p><strong>Ngân hàng:</strong> MB Bank</p>
  <p><strong>Chủ tài khoản:</strong> Dinh Hong Hanh</p>
  <p><strong>Nội dung chuyển khoản:</strong> <span id="noidung"></span></p>

  <button id="xacnhanBtn">Bấm vào đây nếu bạn đã bank</button>
  <p id="thongbao"></p>

  <script>
    // Tạo UID giả để test nếu chưa có
    if (!localStorage.getItem("uid")) {
      localStorage.setItem("uid", "uid_" + Math.floor(Math.random() * 100000));
    }

    const uid = localStorage.getItem("uid");
    const noiDungCK = "NAP_" + uid;
    document.getElementById("noidung").textContent = noiDungCK;

    document.getElementById("xacnhanBtn").addEventListener("click", () => {
      db.ref("giaodich/" + uid).set({
        uid: uid,
        noidung: noiDungCK,
        trangthai: "Đang chờ",
        thoigian: new Date().toLocaleString()
      }, (error) => {
        if (error) {
          alert("Lỗi gửi giao dịch!");
        } else {
          document.getElementById("thongbao").textContent = "✅ Đã gửi yêu cầu duyệt tiền. Vui lòng chờ admin xác nhận.";
        }
      });
    });
  </script>
</body>
</html>
