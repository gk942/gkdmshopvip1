<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Duy·ªát Giao D·ªãch</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #0f172a;
      color: white;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #38bdf8;
    }
    #loginForm, #adminContent {
      max-width: 600px;
      margin: 0 auto;
      background: #1e293b;
      padding: 20px;
      border-radius: 8px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
    }
    button {
      padding: 10px;
      width: 100%;
      background-color: #38bdf8;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #334155;
      text-align: center;
    }
    .status {
      font-weight: bold;
    }
    .pending {
      color: orange;
    }
    .success {
      color: #22c55e;
    }
  </style>
</head>
<body>
  <h2>üîê Admin Duy·ªát Giao D·ªãch</h2>

  <div id="loginForm">
    <input type="password" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u admin..." />
    <button onclick="checkAdmin()">ƒêƒÉng nh·∫≠p admin</button>
    <p id="loginStatus" style="color: red; text-align: center;"></p>
  </div>

  <div id="adminContent" style="display: none;">
    <h3 style="text-align:center;">üìã Danh s√°ch giao d·ªãch ch·ªù duy·ªát</h3>
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>S·ªë ti·ªÅn</th>
          <th>UID</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Duy·ªát</th>
        </tr>
      </thead>
      <tbody id="transactionTable">
        <tr><td colspan="5">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
      </tbody>
    </table>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDBaWDDCkhRa3DQcJBYdznL98GjHmXspuI",
      authDomain: "gkdmshop.firebaseapp.com",
      databaseURL: "https://gkdmshop-default-rtdb.firebaseio.com",
      projectId: "gkdmshop",
      storageBucket: "gkdmshop.appspot.com",
      messagingSenderId: "52437838526",
      appId: "1:52437838526:web:3187795557aa1458190cef"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ADMIN_PASSWORD = "Maka26042006"; // b·∫°n c√≥ th·ªÉ thay ƒë·ªïi n·∫øu mu·ªën

    function checkAdmin() {
      const pass = document.getElementById("adminPassword").value;
      if (pass === ADMIN_PASSWORD) {
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadTransactions();
      } else {
        document.getElementById("loginStatus").innerText = "‚ùå Sai m·∫≠t kh·∫©u!";
      }
    }

    function loadTransactions() {
      const tableBody = document.getElementById("transactionTable");
      const dataRef = ref(db, 'giaodich');
      onValue(dataRef, (snapshot) => {
        tableBody.innerHTML = '';
        if (!snapshot.exists()) {
          tableBody.innerHTML = `<tr><td colspan="5">‚ùå Kh√¥ng c√≥ giao d·ªãch n√†o.</td></tr>`;
          return;
        }
        snapshot.forEach(child => {
          const uid = child.key;
          const data = child.val();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${data.email || '(kh√¥ng c√≥)'}</td>
            <td>${data.sotien}</td>
            <td>${uid}</td>
            <td class="status ${data.trangthai === 'Th√†nh c√¥ng' ? 'success' : 'pending'}">${data.trangthai}</td>
            <td>${data.trangthai === 'Th√†nh c√¥ng' ? '‚úÖ' : `<button onclick="duyetGiaoDich('${uid}')">Duy·ªát</button>`}</td>
          `;
          tableBody.appendChild(row);
        });
      });
    }

    window.duyetGiaoDich = function(uid) {
      const updateRef = ref(db, `giaodich/${uid}`);
      update(updateRef, {
        trangthai: "Th√†nh c√¥ng"
      }).then(() => {
        alert("‚úÖ ƒê√£ duy·ªát th√†nh c√¥ng!");
      });
    }
  </script>
</body>
</html>
