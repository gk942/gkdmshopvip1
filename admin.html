<!DOCTYPE html>
<html>
<head>
  <title>Trang admin duyệt giao dịch</title>
  <script src="firebase.js"></script>
</head>
<body>
  <h2>Admin - Duyệt giao dịch</h2>

  <div id="loginAdmin">
    <input type="password" id="adminPass" placeholder="Nhập mật khẩu admin">
    <button onclick="checkPass()">Đăng nhập</button>
  </div>

  <div id="adminContent" style="display:none;">
    <h3>Danh sách giao dịch</h3>
    <table border="1">
      <thead>
        <tr>
          <th>UID</th>
          <th>Nội dung</th>
          <th>Trạng thái</th>
          <th>Thời gian</th>
          <th>Duyệt</th>
        </tr>
      </thead>
      <tbody id="giaodichTable"></tbody>
    </table>
  </div>

  <script>
    function checkPass() {
      const pass = document.getElementById("adminPass").value;
      if (pass === "Maka26042006") {
        document.getElementById("loginAdmin").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadData();
      } else {
        alert("Sai mật khẩu");
      }
    }

    function loadData() {
      db.ref("giaodich").on("value", (snapshot) => {
        const data = snapshot.val();
        const table = document.getElementById("giaodichTable");
        table.innerHTML = "";

        for (let uid in data) {
          const item = data[uid];
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${item.uid}</td>
            <td>${item.noidung}</td>
            <td>${item.trangthai}</td>
            <td>${item.thoigian}</td>
            <td>
              ${item.trangthai === "Đang chờ" 
                ? `<button onclick="duyetGiaoDich('${uid}')">Duyệt</button>` 
                : "Đã duyệt"}
            </td>
          `;
          table.appendChild(row);
        }
      });
    }

    function duyetGiaoDich(uid) {
      db.ref("giaodich/" + uid + "/trangthai").set("Thành công");
    }
  </script>
</body>
</html>
