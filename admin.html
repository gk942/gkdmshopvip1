<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Duyệt Giao Dịch</title>
</head>
<body>
  <h2>ADMIN - DUYỆT GIAO DỊCH</h2>

  <div id="admin"></div>
  <div id="list"></div>

  <script src="firebase.js"></script>
  <script>
    const pass = prompt("Nhập mật khẩu admin:");
    if (pass !== "Maka26042006") {
      document.body.innerHTML = "<h2>Sai mật khẩu</h2>";
      throw new Error("Không có quyền truy cập");
    }

    const listDiv = document.getElementById("list");
    const ref = database.ref("giaodich");

    ref.on("value", snapshot => {
      listDiv.innerHTML = "";
      snapshot.forEach(child => {
        const data = child.val();
        const key = child.key;

        const box = document.createElement("div");
        box.innerHTML = `
          <p><strong>UID:</strong> ${data.uid}</p>
          <p><strong>Nội dung:</strong> ${data.noidung}</p>
          <p><strong>Trạng thái:</strong> ${data.trangthai}</p>
          ${data.trangthai === "Đang chờ" ? `<button onclick="duyet('${key}')">Duyệt</button>` : ""}
          <hr/>
        `;
        listDiv.appendChild(box);
      });
    });

    function duyet(id) {
      database.ref("giaodich/" + id).update({ trangthai: "Thành công" });
    }
  </script>
</body>
</html>
