<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Duyệt Giao Dịch</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
  <h1 class="text-3xl font-bold mb-4">Quản lý giao dịch</h1>

  <div id="giaodich-list" class="space-y-4"></div>

  <script src="firebase.js" type="module"></script>
  <script type="module">
    import { firebaseFunctions, db } from './firebase.js';

    const { ref, onValue, update } = firebaseFunctions;
    const listDiv = document.getElementById("giaodich-list");

    const gdRef = ref(db, "giaodich");
    onValue(gdRef, (snapshot) => {
      const data = snapshot.val();
      listDiv.innerHTML = "";
      if (!data) return listDiv.innerText = "Không có giao dịch nào.";

      Object.entries(data).forEach(([key, val]) => {
        const item = document.createElement("div");
        item.className = "p-4 bg-gray-800 rounded";
        item.innerHTML = `
          <p><strong>UID:</strong> ${val.uid}</p>
          <p><strong>Thời gian:</strong> ${val.time}</p>
          <p><strong>Trạng thái:</strong> <span id="status-${key}" class="${val.status === 'Thành công' ? 'text-green-400' : 'text-yellow-300'}">${val.status}</span></p>
          ${val.status === "Đang chờ" ? `<button onclick="duyet('${key}')" class="mt-2 bg-blue-500 px-3 py-1 rounded">Duyệt</button>` : ""}
        `;
        listDiv.appendChild(item);
      });
    });

    window.duyet = async (id) => {
      await update(ref(db, "giaodich/" + id), { status: "Thành công" });
    };
  </script>
</body>
</html>
