<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin duyệt giao dịch</title>
  <script src="firebase.js"></script>
</head>
<body>
  <h2>Quản lý giao dịch</h2>
  <input type="password" id="adminpass" placeholder="Nhập mật khẩu admin" />
  <button onclick="dangNhapAdmin()">Đăng nhập</button>

  <div id="banggiaodich" style="display:none;">
    <table border="1">
      <thead>
        <tr><th>UID</th><th>Thời gian</th><th>Trạng thái</th><th>Duyệt</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <script>
    const matkhau = "Maka26042006";

    function dangNhapAdmin() {
      const nhap = document.getElementById('adminpass').value;
      if (nhap !== matkhau) {
        alert("Sai mật khẩu!");
        return;
      }

      document.getElementById("banggiaodich").style.display = "block";

      database.ref("giaodich").on("value", snapshot => {
        const tbody = document.getElementById("tbody");
        tbody.innerHTML = "";

        snapshot.forEach(child => {
          const data = child.val();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${data.uid}</td>
            <td>${data.time}</td>
            <td id="tt-${data.uid}">${data.trangthai}</td>
            <td><button onclick="duyet('${data.uid}')">Duyệt</button></td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    function duyet(uid) {
      database.ref("giaodich/" + uid).update({
        trangthai: "Thành công"
      }).then(() => {
        document.getElementById("tt-" + uid).innerText = "Thành công";
      });
    }
  </script>
</body>
</html>
